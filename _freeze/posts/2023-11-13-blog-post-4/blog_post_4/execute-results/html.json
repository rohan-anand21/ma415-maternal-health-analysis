{
  "hash": "c090d086e20249b1d8a839ec45f8f525",
  "result": {
    "markdown": "---\ntitle: \"Blog Post 4\"\nsubtitle: \"Data Visualization and Modeling\"\nauthor: \"Aiganysh Ulanova, Jin Kyu Cho, Rohan Anand, Seokhoon Shin, Tianyu Wu\"\ndate: \"2023-11-06\"\ndate-modified: \"2023-11-06\"\ndraft: FALSE\n---\n\nWe have chosen 1 table, 1 plot and 1 statistical model for our exploratory data analysis.\n\n1.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(data.table) \nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.2     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.3     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::between()     masks data.table::between()\n✖ dplyr::filter()      masks stats::filter()\n✖ dplyr::first()       masks data.table::first()\n✖ lubridate::hour()    masks data.table::hour()\n✖ lubridate::isoweek() masks data.table::isoweek()\n✖ dplyr::lag()         masks stats::lag()\n✖ dplyr::last()        masks data.table::last()\n✖ lubridate::mday()    masks data.table::mday()\n✖ lubridate::minute()  masks data.table::minute()\n✖ lubridate::month()   masks data.table::month()\n✖ lubridate::quarter() masks data.table::quarter()\n✖ lubridate::second()  masks data.table::second()\n✖ purrr::transpose()   masks data.table::transpose()\n✖ lubridate::wday()    masks data.table::wday()\n✖ lubridate::week()    masks data.table::week()\n✖ lubridate::yday()    masks data.table::yday()\n✖ lubridate::year()    masks data.table::year()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nnatality_data_cleaned <- read_csv(here::here(\"dataset-ignore/natality_data_cleaned.csv\")); setDT(natality_data_cleaned) \n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 100000 Columns: 170\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (54): wic, cig_rec, rf_pdiab, rf_gdiab, rf_phype, rf_ghype, rf_ehype, r...\ndbl (116): dob_yy, dob_mm, dob_tt, dob_wk, bfacil, f_facility, bfacil3, mage...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\n# Relabel mrace31 \nrace_labels <- c(\"White (only)\", \"Black (only)\", \"AIAN (only)\", \"Asian (only)\", \"NHOPI (only)\", \"Black and White\", \"Black and AIAN\", \"Black and Asian\", \"Black and NHOPI\", \"AIAN and White\", \"AIAN and Asian\", \"AIAN and NHOPI\", \"Asian and White\", \"Asian and NHOPI\", \"NHOPI and White\", \"Black, AIAN, and White\", \"Black, AIAN, and Asian\", \"Black, AIAN, and NHOPI\", \"Black, Asian, and White\", \"Black, Asian, and NHOPI\", \"Black, NHOPI, and White\", \"AIAN, Asian, and White\", \"AIAN, NHOPI, and White\", \"AIAN, Asian, and NHOPI\", \"Asian, NHOPI, and White\", \"Black, AIAN, Asian, and White\", \"Black, AIAN, Asian, and NHOPI\", \"Black, AIAN, NHOPI, and White\", \"Black, Asian, NHOPI, and White\", \"AIAN, Asian, NHOPI, and White\") \n\nnatality_data_cleaned[, mrace31 := factor(mrace31, levels = 1:30, labels = race_labels)] \nnatality_data_cleaned <- natality_data_cleaned[!is.na(mrace31) & !is.na(mager) & !is.na(dob_yy) & !is.na(dob_wk)] \navg_age_by_year_week <- natality_data_cleaned[, .(average_age = mean(mager, na.rm = TRUE)), by = .(dob_yy, dob_wk)] \n\n# Adjust the code for counting occurrences of each race category combination \nrace_counts_by_year_week <- natality_data_cleaned[, .N, by = .(dob_yy, dob_wk, mrace31)]; race_counts_by_year_week <- dcast(race_counts_by_year_week, dob_yy + dob_wk ~ mrace31, value.var = \"N\", fill = 0) \n\n# Combine the two tables \nrelationship_table <- merge(avg_age_by_year_week, race_counts_by_year_week, by = c(\"dob_yy\", \"dob_wk\"), all = TRUE) \n\n# View the table \nprint(head(relationship_table)) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   dob_yy dob_wk average_age White (only) Black (only) AIAN (only) Asian (only)\n1:   2021      1    27.47972         4770         1901         251          217\n2:   2021      2    27.89711        11588         3656         335          366\n3:   2021      3    27.69921        12469         3904         367          392\n4:   2021      4    27.68055        12171         3849         394          392\n5:   2021      5    27.70826        12058         3839         356          366\n6:   2021      6    27.80625        10334         3423         374          317\n   NHOPI (only) Black and White Black and AIAN Black and Asian Black and NHOPI\n1:          103              91              4               4               3\n2:          154             197             10               4               3\n3:          155             211             11               7               2\n4:          151             146             16               8               2\n5:          144             196              9               9               2\n6:          157             144             10               7               2\n   AIAN and White AIAN and Asian AIAN and NHOPI Asian and White Asian and NHOPI\n1:            107              4              2              31               6\n2:            157              2              0              61               6\n3:            150              3              1              65              10\n4:            134              5              0              56               6\n5:            143              4              3              62              11\n6:            143              3              2              51               1\n   NHOPI and White Black, AIAN, and White Black, AIAN, and Asian\n1:               5                     12                      0\n2:               6                      4                      0\n3:              13                     12                      1\n4:               6                     10                      1\n5:              11                      6                      1\n6:               9                      9                      0\n   Black, AIAN, and NHOPI Black, Asian, and White Black, Asian, and NHOPI\n1:                      0                       3                       0\n2:                      0                       5                       0\n3:                      0                       4                       0\n4:                      0                       4                       1\n5:                      0                       2                       0\n6:                      0                       1                       0\n   Black, NHOPI, and White AIAN, Asian, and White AIAN, NHOPI, and White\n1:                       0                      3                      0\n2:                       0                      1                      1\n3:                       1                      4                      3\n4:                       1                      4                      2\n5:                       0                      2                      1\n6:                       0                      6                      0\n   AIAN, Asian, and NHOPI Asian, NHOPI, and White Black, AIAN, Asian, and White\n1:                      0                       2                             0\n2:                      1                       2                             1\n3:                      0                       6                             1\n4:                      0                       4                             0\n5:                      0                       2                             1\n6:                      1                       8                             2\n   Black, AIAN, NHOPI, and White Black, Asian, NHOPI, and White\n1:                             1                              0\n2:                             1                              0\n3:                             0                              0\n4:                             0                              1\n5:                             0                              1\n6:                             0                              0\n   AIAN, Asian, NHOPI, and White\n1:                             1\n2:                             0\n3:                             1\n4:                             0\n5:                             2\n6:                             0\n```\n:::\n:::\n\n\nFor the first table, we have chosen the 'average_age' across years and weeks (‘dob_yy’ and 'dob_wk') that could reveal seasonal patterns in maternal age (‘mrace31’). Moreover, it breaks down the numbers by race and ethnicity, indicating the number of births for different racial and ethnic combinations (White, Black, AIAN(American Indian or Alaska Native), Asian, NHPI(Native Hawaiian or other Pacific Islander), and combinations thereof). The average age of individuals seems around 29 for all entries and does not change much. Furthermore, the numerical values are highest for the ‘White (only)’ category and lowest for the combination of ‘Black’, ‘AIAN’, ‘Asian’, and ‘NHOPI’.\n\n2.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load necessary libraries \nlibrary(ggplot2) \nlibrary(dplyr) \nlibrary(tidyr) \n\n# Read the dataset \ndata <- read.csv(here::here('dataset-ignore','natality_data_cleaned.csv')) \n\n# Filter out unknown race and unknown smoking status \nfiltered_data_new <- data[data$mrace15 != 15 & data$cig0_r != 6, ] \n\n# Creating a cross-tabulation of mother's race and smoking before pregnancy \nrace_smoking_crosstab <- table(filtered_data_new$mrace15, filtered_data_new$cig0_r) \nrace_smoking_crosstab <- prop.table(race_smoking_crosstab, 1) \n\n# Normalize by row \n# Converting the table to a dataframe for ggplot \n\ndf_new <- as.data.frame(race_smoking_crosstab) \ncolnames(df_new) <- c('Race', 'Smoking', 'Proportion') \n\n# Renaming races and smoking categories for better readability \ndf_new$Race <- factor(df_new$Race, levels = c(1:14), labels = c('White', 'Black', 'AIAN', 'Asian Indian', 'Chinese', 'Filipino', 'Japanese', 'Korean', 'Vietnamese', 'Other Asian',                               'Hawaiian', 'Guamanian', 'Samoan', 'Other pacific Islander')) \n\ndf_new$Smoking <- factor(df_new$Smoking, levels = c(0:5), labels = c('Nonsmoker', '1-5 cigarettes', '6-10 cigarettes', '11-20 cigarettes', '21-40 cigarettes', '41 or more cigarettes')) \n\n# Plotting the grouped bar chart \nggplot(df_new, aes(fill=Smoking, y=Proportion, x=Race)) + geom_bar(position=\"fill\", stat=\"identity\") +     theme(axis.text.x = element_text(angle = 45, hjust = 1)) + labs(x = \"Mother’s Race\", y = \"Proportion of Mothers\", fill = \"Cigarettes Before Pregnancy\", title = \"Cigarette Consumption Before Pregnancy by Mother’s Race\")\n```\n\n::: {.cell-output-display}\n![](blog_post_4_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nWe chose the variable \"cig0_r\", which represents cigarette consumption before pregnancy, and the variable \"mrace15\" which represents the mother's race, to conduct the exploratory data analysis. We created a bar chart to see if is there a relationship between smoking habits before pregnancy and different races of mothers. The bar chart above displays the proportions of smokers among mothers before pregnancy vs. various races of mothers. We can see that 1. AIAN mothers have the highest proportion of smokers before pregnancy. Asian Indian, Chinese, Filipino, and Vietnamese mothers have the lowest proportion of smokers before pregnancy. 2. AIAN mothers have the highest proportion of 1-5 cigarettes and 41 or more cigarettes consumed per day before pregnancy among all races. Hawaiian mothers have the highest proportion of 6-10 cigarette consumption per day before pregnancy among all races. So there is a correlation between race and consumption of cigarettes before pregnancy.\n\n3.\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\nnat <- read_csv(here::here(\"dataset-ignore/natality_data_cleaned.csv\"), show_col_types = FALSE) |>\n  filter(precare != 99) |>\n  filter(combgest != 99) |>\n  filter(previs != 99) |> \n  filter(ab_nicu != 'U') |>\n  mutate(ab_nicu = as.integer(ifelse(ab_nicu == 'Y', 1, ifelse(ab_nicu == 'N', 0, ab_nicu)))) |>\n  filter(mm_aicu != 'U') |>\n  mutate(mm_aicu = as.integer(ifelse(mm_aicu == 'Y', 1, ifelse(mm_aicu == 'N', 0, mm_aicu)))) |>\n  filter(gestrec3 != 3) |>\n  mutate(gestrec3 = gestrec3 - 1)\n  \n\nbirth_weight = nat$dbwt\nmager = nat$mager\nprenatal_care_start = nat$precare\nmrace = nat$mrace31\nsmoking_status = nat$cig0_r\n\n#Linear\nmodel1 <- lm(birth_weight ~ prenatal_care_start + mrace + smoking_status, data = nat)\n\n\n# Plotting observed vs. predicted birth weight\npredicted_birth_weight <- predict(model1)\nplot(birth_weight, predicted_birth_weight, xlab = \"Observed Birth Weight\", ylab = \"Predicted Birth Weight\", main = \"Observed vs Predicted Birth Weight\")\nabline(0, 1, col = \"red\")\n```\n\n::: {.cell-output-display}\n![](blog_post_4_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\nThe statistical model we choose is linear regression. We did linear regression to predict birth weight based on a number of variables such as mothers age, start of prenatal care, race and whether they smoked cigarettes before pregnancy. We fitted the model and plotted a scatter plot of observed by predicted. There is significant variation since the all of the points are not aggregated around the red line, indicating that transformations, such as log or other, should be made on the variables. However, a non-substantial amount of points aggregate around the line, indicating that the variables used in the predictor are capable of producing accurate predictions. Therefore, there is a slight correlation between birth weight and smoking status, mothers age, start of prenatal care and race. \n\n",
    "supporting": [
      "blog_post_4_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}